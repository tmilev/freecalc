\solution{ \ref{problemIntegral x^4/((x^2+2)(x+1)^2)}
To integrate a rational function, we need to decompose it into partial fractions. 

Since the numerator of the function is of degree greater than or equal to the denominator, we start the partial fraction decomposition by polynomial division.
\renewcommand{\arraystretch}{1.2}\begin{longtable}{|cccccc|} \hline&\multicolumn{5}{|c|}{\textbf{Remainder}}\\\multicolumn{1}{|c|}{} & &$\color{red}{-2x^{3}}\color{black}$ & $\color{red}{-3x^{2}}\color{black}$ & $\color{red}{-4x }\color{black}$ & $\color{red}{-2}\color{black}$ \\\hline\textbf{Divisor(s)} &\multicolumn{5}{|c|}{\textbf{Quotient(s)}}\\$x^{4}+2x^{3}+3x^{2}+4x +2$& \multicolumn{5}{|l|}{$1$}\\\hline& \multicolumn{5}{|c|}{\textbf{Dividend}}\\\multicolumn{1}{|c|}{$\underline{~}$} &$x^{4}$ & &&&\\&$x^{4}$ & $+2x^{3}$ & $+3x^{2}$ & $+4x $ & $+2$ \\\cline{2-6}&&$\color{red}{-2x^{3}}\color{black}$ & $\color{red}{-3x^{2}}\color{black}$ & $\color{red}{-4x }\color{black}$ & $\color{red}{-2}\color{black}$ \\\hline\end{longtable}
Our next step is to factor the denominator: 
\[
x^{4}+2x^{3}+3x^{2}+4x +2=\left(x +1\right)^2 \left(x^{2}+2\right).
\]
Next, we combine the two steps:
\[
\renewcommand{\arraystretch}{1.7}
\begin{array}{rcl}
\displaystyle \frac{x^{4}}{x^{4}+2x^{3}+3x^{2}+4x +2}&=&\displaystyle 1+ \frac{-2x^3-3x ^2-4x-2}{x^{4}+2x^{3} +3x^{2} +4x +2}\\
\displaystyle \frac{-2x^3-3x^2-4x-2}{x^{4}+2x^{3}+3x^{2}+4x +2} & =&\displaystyle  \frac{-2x^3-3x^2-4x-2 }{\left(x +1\right)^2\left(x^{2}+2\right)}\\
&=&\displaystyle  \frac{A_1}{(x+1)}+\frac{A_2}{(x+1)^2}+\frac{A_3+A_4x}{(x^2+2)}.
\end{array}
\]
We seek to find $A_i$'s that turn the above expression into an identity. Just as in the solution of Problem \ref{problemIntegrate x/(2x^2+x-1)dx}, we will use the method of coefficient comparison. We note that the solutions of Problems \ref{problemint(3x^2+2x-1)/((x-1)(x^2+1))dx} and  \ref{problemIntegrate x/(2x^2+x-1)dx} provide a shortcut method.


After clearing denominators, we get the following equality. 

\noindent$\begin{array}{@{}rcl@{}}
-2x^{3}-3x^{2}-4x -2 &=& A_{1} (x +1)(x^{2}+2)+A_{2} (x^{2}+2)\\
&&+(A_{3} + A_{4} x)(x +1)^{2}\\
0&=&(A_{4} +A_{1} +2)x^{3}\\
&&+(2A_{4} +A_{3} +A_{2} +A_{1} +3)x^{2}\\
&&+(A_{4} +2A_{3} +2A_{1} +4)x \\
&&+(A_{3} +2A_{2} +2A_{1} +2)\quad .
\end{array}
$

\noindent In order to turn the above into an identity we need to select $A_i$'s such that the coefficients of all powers of $x$ become zero. In other words, we need to solve the following system. 
\[
\begin{array}{llllll} & A_{1} & & & +A_{4} & =-2\\ & A_{1} & +A_{2} & +A_{3} & +2A_{4} & =-3\\ & 2A_{1} & & +2A_{3} & +A_{4} & =-4\\ & 2A_{1} & +2A_{2} & +A_{3} & & =-2\quad .\\
\end{array}
\] 
This is a system of linear equations. There exists a standard method for solving such systems called Gaussian Elimination (this method is also known as the row-echelon form reduction method). This method is very well suited for computer implementation. We illustrate it on this particular example; for a description of the method in full generality we direct the reader to a standard course in Linear algebra. 

\begin{longtable}{cc} System status & Action \\\hline $\begin{array}{llllll} & A_{1} & & & +A_{4} & =-2\\ & A_{1} & +A_{2} & +A_{3} & +2A_{4} & =-3\\ & 2A_{1} & & +2A_{3} & +A_{4} & =-4\\ & 2A_{1} & +2A_{2} & +A_{3} & & =-2\\\end{array}$& Sel. pivot column 2. Eliminate non-pivot entries. \\\hline $\begin{array}{llllll} & A_{1} & & & +A_{4} & =-2\\ & & A_{2} & +A_{3} & +A_{4} & =-1\\ & & & 2A_{3} & -A_{4} & =0\\ & & 2A_{2} & +A_{3} & -2A_{4} & =2\\\end{array}$& Sel. pivot column 3. Eliminate non-pivot entries. \\\hline $\begin{array}{llllll} & A_{1} & & & +A_{4} & =-2\\ & & A_{2} & +A_{3} & +A_{4} & =-1\\ & & & 2A_{3} & -A_{4} & =0\\ & & & -A_{3} & -4A_{4} & =4\\\end{array}$& Sel. pivot column 4. Eliminate non-pivot entries. \\\hline $\begin{array}{llllll} & A_{1} & & & +A_{4} & =-2\\ & & A_{2} & & +\frac{3}{2}A_{4} & =-1\\ & & & A_{3} & -\frac{A_{4} }{2} & =0\\ & & & & -\frac{9}{2}A_{4} & =4\\\end{array}$& Sel. pivot column 5. Eliminate non-pivot entries. \\\hline $\begin{array}{llllll} & A_{1} & & & & =-\frac{10}{9}\\ & & A_{2} & & & =\frac{1}{3}\\ & & & A_{3} & & =-\frac{4}{9}\\ & & & & A_{4} & =-\frac{8}{9}\\\end{array}$& Final result.\\ \end{longtable}

Therefore, the final partial fraction decomposition is the following. 
\[\begin{array}{rcl}
\displaystyle \frac{x^{4}}{x^{4}+2x^{3}+3x^{2}+4x +2}&=&\displaystyle 1+ \frac{-2x^{3}- 3x^{2}-4x -2}{x^{4}+2x^{3}+3x^{2}+4x +2}\\
&=&\displaystyle 1+ \frac{-\frac{10}{9}}{(x +1)}+\frac{\frac{1}{3}}{(x +1)^{2}}+\frac{-\frac{8}{9}x -\frac{4}{9}}{(x^{2}+2)}
\end{array}
\]

Therefore we can integrate as follows.
\[
\begin{array}{rcl}
\displaystyle \int \frac{x^4}{(x^2+2)(x+1)^2} \diff x &=&\displaystyle \int \left( 1+ \frac{-\frac{10}{9}}{(x +1)}+\frac{\frac{1}{3}}{(x +1)^{2}}+\frac{-\frac{8}{9}x -\frac{4}{9}}{(x^{2}+2)}\right)\diff x\\
&=&\displaystyle \int \diff x-\frac{10}{9}\int \frac{1}{(x +1)}\diff x + \frac{ 1}{3}\int \frac{ 1}{(x +1)^{2}}\diff x \\
&&\displaystyle -\frac{8}{9} \int \frac{x}{x^{2}+2}\diff x-\frac{4}{9} \int \frac{ 1}{x^{2}+2}\diff x \\
&=&\displaystyle x -\frac{1}{3} (x+1)^{-1}-\frac{10}{9} \log{}\left(x+1\right)\\
&&\displaystyle -\frac{4}{9} \log{}\left(x^{2} +2\right) -\frac{ 2}{ 9} \sqrt{ 2} \arctan{}\left(\frac{\sqrt{2}}{2} x\right)+C
\end{array}
\]
}

\input{../../modules/partial-fractions/homework/integration-rational-functions-complete-1-subproblem-11-solution}

\input{../../modules/partial-fractions/homework/integration-rational-functions-complete-1-subproblem-13-solution}