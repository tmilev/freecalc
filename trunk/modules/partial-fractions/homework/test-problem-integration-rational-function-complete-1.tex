Integrate 
\[
\int \frac{x^4}{(x^2+2)(x+1)^2}\diff x
\]